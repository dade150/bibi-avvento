<!DOCTYPE html>
<html lang="it">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>Giorno 8 - Cruciverba Grey's Anatomy</title>

 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap" rel="stylesheet">

 <style>
  * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
  }
  
  body {
   font-family: 'Mountains of Christmas', cursive;
   background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
   color: #fff;
   min-height: 100vh;
   display: flex;
   flex-direction: column;
   justify-content: center;
   align-items: center;
   padding: 2rem;
   position: relative;
  }
  
  /* Particelle fluttuanti di sfondo */
  body::before {
   content: '';
   position: absolute;
   width: 100%;
   height: 100%;
   background-image: 
    radial-gradient(2px 2px at 20% 30%, white, transparent),
    radial-gradient(2px 2px at 60% 70%, white, transparent),
    radial-gradient(1px 1px at 50% 50%, white, transparent),
    radial-gradient(1px 1px at 80% 10%, white, transparent),
    radial-gradient(2px 2px at 90% 60%, white, transparent),
    radial-gradient(1px 1px at 33% 80%, white, transparent),
    radial-gradient(1px 1px at 75% 40%, white, transparent);
   background-size: 200% 200%;
   animation: float 20s ease-in-out infinite;
   opacity: 0.3;
  }
  
  @keyframes float {
   0%, 100% { transform: translateY(0); }
   50% { transform: translateY(-20px); }
  }
  
  .content-box {
   background: linear-gradient(135deg, rgba(139, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.95) 100%);
   border: 5px solid;
   border-image: linear-gradient(45deg, gold, #ffed4e, gold) 1;
   border-radius: 25px;
   padding: 3rem;
   max-width: 900px; /* Increased max-width for crossword */
   text-align: center;
   box-shadow: 
    0 0 30px rgba(255, 215, 0, 0.3),
    0 0 60px rgba(255, 215, 0, 0.2),
    inset 0 0 50px rgba(0, 0, 0, 0.5);
   position: relative;
   z-index: 1;
   animation: glow-pulse 3s ease-in-out infinite;
  }
  
  @keyframes glow-pulse {
   0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 60px rgba(255, 215, 0, 0.2), inset 0 0 50px rgba(0, 0, 0, 0.5); }
   50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.5), 0 0 80px rgba(255, 215, 0, 0.3), inset 0 0 50px rgba(0, 0, 0, 0.5); }
  }
  
  h1 {
   color: gold;
   text-shadow: 
    2px 2px 4px black,
    0 0 20px rgba(255, 215, 0, 0.5),
    0 0 30px rgba(255, 215, 0, 0.3);
   font-size: 2.8rem;
   margin-bottom: 2rem;
   animation: title-glow 2s ease-in-out infinite alternate;
  }
  
  @keyframes title-glow {
   from { text-shadow: 2px 2px 4px black, 0 0 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.3); }
   to { text-shadow: 2px 2px 4px black, 0 0 30px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.5); }
  }
  
  .message-container {
   background: rgba(0, 0, 0, 0.4);
   border-radius: 15px;
   padding: 2rem;
   margin: 1.5rem 0;
   border: 2px solid rgba(255, 215, 0, 0.3);
  }
  
  p {
   font-size: 1.4rem;
   line-height: 1.8;
   min-height: 100px;
  }
  
  .back-button, .btn-game { 
   margin: 0.5rem;
   background: linear-gradient(135deg, gold 0%, #ffed4e 100%);
   color: darkred;
   border: 2px solid rgba(139, 0, 0, 0.5);
   font-weight: bold;
   font-size: 1.2rem;
   padding: 0.7rem 2rem;
   border-radius: 50px;
   transition: all 0.3s ease;
   box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
   cursor: pointer;
  }
  
  .back-button:hover, .btn-game:hover { 
   transform: translateY(-3px) scale(1.05);
   box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
   background: linear-gradient(135deg, #ffed4e 0%, gold 100%);
  }
  
  .btn-game:active { 
   transform: translateY(-1px);
  }
  
  #result-area {
   margin-top: 2rem;
   min-height: 100px;
  }
  
  .emoji-sparkle {
   display: inline-block;
   animation: sparkle 1.5s ease-in-out infinite;
  }
  
  @keyframes sparkle {
   0%, 100% { transform: scale(1) rotate(0deg); }
   50% { transform: scale(1.2) rotate(180deg); }
  }
  
  .result-message {
   font-size: 1.6rem;
   padding: 1.5rem;
   border-radius: 15px;
   margin-top: 1rem;
   animation: fadeInUp 0.5s ease-out;
  }
  
  @keyframes fadeInUp {
   from { opacity: 0; transform: translateY(20px); }
   to { opacity: 1; transform: translateY(0); }
  }
  
  .success-message {
   color: #90EE90;
   text-shadow: 0 0 10px rgba(144, 238, 144, 0.5);
  }
  
  .punch-message { 
   color: #FFD700;
   text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }
  
  .lab-icon {
   font-size: 2rem;
   margin: 0 0.3rem;
   display: inline-block;
   animation: float-icon 3s ease-in-out infinite;
  }
  
  @keyframes float-icon {
   0%, 100% { transform: translateY(0); }
   50% { transform: translateY(-10px); }
  }

  /* Crossword Specific Styles */
  .crossword-container {
      margin-top: 2rem;
      display: none; /* Hidden until game starts */
      width: 100%;
      max-width: 700px; /* Adjust as needed for grid size */
      margin-left: auto; /* Center the container */
      margin-right: auto; /* Center the container */
  }

  .crossword-grid {
      display: grid;
      grid-template-columns: repeat(12, 40px); /* 12 columns, 40px each */
      grid-template-rows: repeat(12, 40px); /* 12 rows, 40px each */
      gap: 1px;
      border: 2px solid gold;
      margin: 1rem auto; /* Center the grid */
      background-color: rgba(0, 0, 0, 0.7);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
  }

  .grid-cell {
      position: relative;
      width: 40px;
      height: 40px;
      background-color: transparent; /* Default for empty cells */
      display: flex;
      justify-content: center;
      align-items: center;
  }

  .grid-cell.active-cell {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
  }

  .grid-cell input {
      width: 100%;
      height: 100%;
      border: none;
      background-color: transparent;
      color: #fff;
      font-size: 1.5rem;
      text-align: center;
      text-transform: uppercase;
      padding: 0;
      box-sizing: border-box;
      outline: none;
  }

  .grid-cell input:focus {
      background-color: rgba(255, 255, 255, 0.2);
  }

  .clue-number {
      position: absolute;
      top: 2px;
      left: 2px;
      font-size: 0.7rem;
      color: gold;
      font-weight: bold;
      z-index: 2;
  }

  .clues-section {
      display: flex;
      justify-content: space-around;
      margin-top: 2rem;
      flex-wrap: wrap;
      gap: 2rem;
  }

  .clues-section h3 {
      color: gold;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      margin-bottom: 1rem;
      font-size: 1.8rem;
  }

  .clues-list {
      text-align: left;
      list-style-type: none;
      padding: 0;
      margin: 0;
  }

  .clues-list li {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
  }

  .crossword-buttons {
      margin-top: 2rem;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
  }
 </style>
</head>

<body>
 <audio id="sound-track" loop>
  <source src="audio/sound-track0.mp3" type="audio/mpeg"> 
 </audio>
 
 <audio id="sound-win">
  <source src="audio/soundwin.mp3" type="audio/mpeg">
 </audio>

 <div class="content-box">
  <h1>
   <span class="emoji-sparkle">ü©∫</span> 
   Cruciverba Grey's Anatomy 
   <span class="emoji-sparkle">üè•</span>
  </h1>
  
  <div class="message-container" id="intro-message">
   <p>
    Benvenuta nel cruciverba a tema Grey's Anatomy! Metti alla prova la tua conoscenza del Seattle Grace e dei suoi dottori.
    Quando sei pronta, clicca su "Inizia il Gioco" e risolvi le 12 domande. In bocca al lupo, Davide! ‚ù§Ô∏è
   </p>
  </div>

  <button class="btn btn-game" id="startGameButton">Inizia il Gioco ‚ú®</button>

  <div class="crossword-container" id="crosswordGame">
   <div class="crossword-grid" id="crosswordGrid">
    <!-- Crossword grid cells will be inserted here by JavaScript -->
   </div>
   
   <div class="clues-section">
    <div>
        <h3>Orizzontale</h3>
        <ul class="clues-list" id="horizontal-clues">
            <!-- Horizontal clues will be inserted here by JavaScript -->
        </ul>
    </div>
    <div>
        <h3>Verticale</h3>
        <ul class="clues-list" id="vertical-clues">
            <!-- Vertical clues will be inserted here by JavaScript -->
        </ul>
    </div>
   </div>

   <div class="crossword-buttons">
    <button class="btn btn-game" id="checkAnswersButton">Controlla Risposte ‚úÖ</button>
    <button class="btn btn-game" id="resetGameButton">Resetta Gioco üîÑ</button>
   </div>
  </div>

  <div id="result-area"></div>

  <a href="index.html" class="btn back-button" id="back-to-calendar" style="display: none;">
   üéÑ Torna al Calendario
  </a>
 </div>

 <script>
  const soundtrack = document.getElementById('sound-track');
  const soundwin = document.getElementById('sound-win');
  const startGameButton = document.getElementById('startGameButton');
  const crosswordGame = document.getElementById('crosswordGame');
  const crosswordGridElement = document.getElementById('crosswordGrid');
  const horizontalCluesElement = document.getElementById('horizontal-clues');
  const verticalCluesElement = document.getElementById('vertical-clues');
  const checkAnswersButton = document.getElementById('checkAnswersButton');
  const resetGameButton = document.getElementById('resetGameButton');
  const resultArea = document.getElementById('result-area');
  const backButton = document.getElementById('back-to-calendar');
  const introMessage = document.getElementById('intro-message');

  // Define the words and their placement (row, col are 0-indexed)
  // Format: { clue: "...", answer: "WORD", startRow: R, startCol: C, direction: "H"|"V", clueNum: N }
  const wordsData = [
      // Horizontal
      { clue: "1. Il chirurgo cardiotoracico che ha sposato Cristina.", answer: "BURKE", startRow: 1, startCol: 1, direction: "H", clueNum: 1 },
      { clue: "2. L'ospedale prima di chiamarsi Grey Sloan ______ Memorial.", answer: "GRACE", startRow: 3, startCol: 4, direction: "H", clueNum: 2 },
      { clue: "3. La figlia di Meredith e Derek.", answer: "ZOLA", startRow: 5, startCol: 1, direction: "H", clueNum: 3 },
      { clue: "4. La dottoressa che √® 'la persona' di Meredith.", answer: "CRISTINA", startRow: 7, startCol: 2, direction: "H", clueNum: 4 },
      { clue: "5. Il cognome del dottore che ha lasciato per l'esercito.", answer: "HUNT", startRow: 9, startCol: 1, direction: "H", clueNum: 5 },
      { clue: "6. La dottoressa che ha sposato Jackson Avery.", answer: "APRIL", startRow: 9, startCol: 7, direction: "H", clueNum: 6 },

      // Vertical
      { clue: "7. Cognome del dottore noto come 'McDreamy'.", answer: "SHEPHERD", startRow: 0, startCol: 3, direction: "V", clueNum: 7 },
      { clue: "8. Il soprannome di Mark Sloan.", answer: "MCSTEAMY", startRow: 0, startCol: 7, direction: "V", clueNum: 8 },
      { clue: "9. Il primario di chirurgia per le prime stagioni.", answer: "RICHARD", startRow: 2, startCol: 1, direction: "V", clueNum: 9 },
      { clue: "10. La specializzazione di Callie Torres.", answer: "ORTOPEDIA", startRow: 1, startCol: 5, direction: "V", clueNum: 10 },
      { clue: "11. Il dottore pediatrico che ha sposato Jo.", answer: "ALEX", startRow: 0, startCol: 9, direction: "V", clueNum: 11 },
      { clue: "12. La dottoressa che ha avuto un tumore al cervello.", answer: "AMELIA", startRow: 4, startCol: 11, direction: "V", clueNum: 12 }
  ];

  const GRID_ROWS = 12;
  const GRID_COLS = 12;
  const gridData = Array(GRID_ROWS).fill(null).map(() => Array(GRID_COLS).fill(null));

  // Populate gridData with letters and clue numbers
  wordsData.forEach(wordObj => {
      for (let i = 0; i < wordObj.answer.length; i++) {
          let r = wordObj.startRow;
          let c = wordObj.startCol;
          if (wordObj.direction === "H") {
              c += i;
          } else { // V
              r += i;
          }

          if (r < GRID_ROWS && c < GRID_COLS) {
              if (!gridData[r][c]) {
                  gridData[r][c] = { letter: '', clueH: null, clueV: null };
              }

              if (i === 0) { // Mark clue number at the start of the word
                  if (wordObj.direction === "H") {
                      gridData[r][c].clueH = wordObj.clueNum;
                  } else {
                      gridData[r][c].clueV = wordObj.clueNum;
                  }
              }
          }
      }
  });

  function renderClues() {
      horizontalCluesElement.innerHTML = '';
      verticalCluesElement.innerHTML = '';

      wordsData.filter(w => w.direction === "H").forEach(w => {
          const li = document.createElement('li');
          li.textContent = w.clue;
          horizontalCluesElement.appendChild(li);
      });

      wordsData.filter(w => w.direction === "V").forEach(w => {
          const li = document.createElement('li');
          li.textContent = w.clue;
          verticalCluesElement.appendChild(li);
      });
  }

  function renderCrosswordGrid() {
      crosswordGridElement.innerHTML = '';
      for (let r = 0; r < GRID_ROWS; r++) {
          for (let c = 0; c < GRID_COLS; c++) {
              const cellDiv = document.createElement('div');
              cellDiv.classList.add('grid-cell');
              cellDiv.dataset.row = r;
              cellDiv.dataset.col = c;

              const cellData = gridData[r][c];

              if (cellData) { // If there's any data (i.e., it's part of a word)
                  cellDiv.classList.add('active-cell');
                  const input = document.createElement('input');
                  input.type = 'text';
                  input.maxLength = '1';
                  input.id = `cell-${r}-${c}`;
                  input.dataset.row = r;
                  input.dataset.col = c;
                  cellDiv.appendChild(input);

                  if (cellData.clueH !== null || cellData.clueV !== null) {
                      const clueSpan = document.createElement('span');
                      clueSpan.classList.add('clue-number');
                      // Prefer horizontal clue number if both exist, or just show one
                      clueSpan.textContent = cellData.clueH || cellData.clueV; 
                      cellDiv.appendChild(clueSpan);
                  }
              }
              crosswordGridElement.appendChild(cellDiv);
          }
      }
  }

  function startGame() {
    introMessage.style.display = 'none';
    startGameButton.style.display = 'none';
    crosswordGame.style.display = 'block';
    renderCrosswordGrid(); // Grid first
    renderClues();        // Clues after
    soundtrack.volume = 0.5; // Adjust volume if needed
    soundtrack.play().catch(e => console.log("Audio play prevented:", e));
  }

  function checkAnswers() {
    let allCorrect = true;
    resultArea.innerHTML = ''; // Clear previous messages

    const inputCells = document.querySelectorAll('.crossword-grid input');
    inputCells.forEach(input => {
      const r = parseInt(input.dataset.row);
      const c = parseInt(input.dataset.col);
      
      // Find the correct letter for this cell from wordsData
      let correctLetter = '';
      wordsData.forEach(wordObj => {
          for (let i = 0; i < wordObj.answer.length; i++) {
              let currentR = wordObj.startRow;
              let currentC = wordObj.startCol;
              if (wordObj.direction === "H") {
                  currentC += i;
              } else { // V
                  currentR += i;
              }
              if (currentR === r && currentC === c) {
                  correctLetter = wordObj.answer[i];
                  break; // Found the letter for this cell
              }
          }
      });

      if (input.value.toUpperCase().trim() === correctLetter) {
        input.style.backgroundColor = 'rgba(144, 238, 144, 0.3)'; // Light green
        input.style.color = '#90EE90';
      } else {
        input.style.backgroundColor = 'rgba(255, 215, 0, 0.3)'; // Gold for incorrect
        input.style.color = '#FFD700';
        allCorrect = false;
      }
    });

    if (allCorrect) {
      soundtrack.pause();
      soundtrack.currentTime = 0;
      soundwin.volume = 0.7; // Adjust volume
      soundwin.play().catch(e => console.log("Win audio play prevented:", e));
      resultArea.innerHTML = `
        <div class="result-message success-message">
         <span class="lab-icon">üéâ</span>
         Complimenti Davide! Hai completato il cruciverba a tema Grey's Anatomy!
         <span class="lab-icon">ü•≥</span>
        </div>
      `;
      backButton.style.display = 'inline-block';
      checkAnswersButton.style.display = 'none';
      resetGameButton.style.display = 'none';
      // Disable inputs after completion
      inputCells.forEach(input => {
        input.disabled = true;
      });
    } else {
      resultArea.innerHTML = `
        <div class="result-message punch-message">
         <span class="lab-icon">ü§î</span>
         Alcune risposte sono sbagliate. Riprova!
         <span class="lab-icon">üí°</span>
        </div>
      `;
    }
  }

  function resetGame() {
    const inputCells = document.querySelectorAll('.crossword-grid input');
    inputCells.forEach(input => {
      input.value = ''; // Clear input values
      input.style.backgroundColor = 'transparent'; // Reset background color
      input.style.color = '#fff'; // Reset text color
      input.disabled = false; // Enable inputs
    });
    resultArea.innerHTML = ''; // Clear result message
    soundtrack.currentTime = 0;
    soundtrack.play().catch(e => console.log("Audio play prevented:", e));
    checkAnswersButton.style.display = 'inline-block';
    resetGameButton.style.display = 'inline-block';
    backButton.style.display = 'none';
  }

  startGameButton.addEventListener('click', startGame);
  checkAnswersButton.addEventListener('click', checkAnswers);
  resetGameButton.addEventListener('click', resetGame);

  // Fallback: try to start audio on first user interaction for browsers that block autoplay
  document.body.addEventListener('click', () => {
    if (soundtrack.paused) {
      soundtrack.play().catch(e => console.log("Audio play prevented:", e));
    }
  }, { once: true });

 </script>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
