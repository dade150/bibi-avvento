<!DOCTYPE html>
<html lang="it">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>Giorno 8 - Cruciverba Grey's Anatomy</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap" rel="stylesheet">
 <style>
  * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
  }
  
  body {
   font-family: 'Mountains of Christmas', cursive;
   background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
   color: #fff;
   min-height: 100vh;
   display: flex;
   flex-direction: column;
   justify-content: center;
   align-items: center;
   padding: 2rem;
   position: relative;
   overflow-x: hidden;
   overflow-y: auto;
  }
  
  body::before {
   content: '';
   position: fixed;
   width: 100%;
   height: 100%;
   background-image: 
    radial-gradient(2px 2px at 20% 30%, white, transparent),
    radial-gradient(2px 2px at 60% 70%, white, transparent),
    radial-gradient(1px 1px at 50% 50%, white, transparent),
    radial-gradient(1px 1px at 80% 10%, white, transparent),
    radial-gradient(2px 2px at 90% 60%, white, transparent),
    radial-gradient(1px 1px at 33% 80%, white, transparent),
    radial-gradient(1px 1px at 75% 40%, white, transparent);
   background-size: 200% 200%;
   animation: float 20s ease-in-out infinite;
   opacity: 0.3;
   z-index: 0;
  }
  
  @keyframes float {
   0%, 100% { transform: translateY(0); }
   50% { transform: translateY(-20px); }
  }

  .snowflake {
   position: fixed;
   top: -10px;
   color: white;
   font-size: 1em;
   font-family: Arial, sans-serif;
   text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
   z-index: 0;
   user-select: none;
   pointer-events: none;
   animation: fall linear infinite;
  }
  
  @keyframes fall {
   to {
    transform: translateY(100vh) translateX(100px);
    opacity: 0;
   }
  }
  
  .content-box {
   background: linear-gradient(135deg, rgba(139, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.95) 100%);
   border: 5px solid;
   border-image: linear-gradient(45deg, gold, #ffed4e, gold) 1;
   border-radius: 25px;
   padding: 3rem;
   max-width: 900px;
   text-align: center;
   box-shadow: 
    0 0 30px rgba(255, 215, 0, 0.3),
    0 0 60px rgba(255, 215, 0, 0.2),
    inset 0 0 50px rgba(0, 0, 0, 0.5);
   position: relative;
   z-index: 1;
   animation: glow-pulse 3s ease-in-out infinite;
  }
  
  @keyframes glow-pulse {
   0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 60px rgba(255, 215, 0, 0.2), inset 0 0 50px rgba(0, 0, 0, 0.5); }
   50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.5), 0 0 80px rgba(255, 215, 0, 0.3), inset 0 0 50px rgba(0, 0, 0, 0.5); }
  }
  
  h1 {
   color: gold;
   text-shadow: 
    2px 2px 4px black,
    0 0 20px rgba(255, 215, 0, 0.5),
    0 0 30px rgba(255, 215, 0, 0.3);
   font-size: 2.8rem;
   margin-bottom: 2rem;
   animation: title-glow 2s ease-in-out infinite alternate;
  }
  
  @keyframes title-glow {
   from { text-shadow: 2px 2px 4px black, 0 0 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.3); }
   to { text-shadow: 2px 2px 4px black, 0 0 30px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.5); }
  }
  
  .message-container {
   background: rgba(0, 0, 0, 0.4);
   border-radius: 15px;
   padding: 2rem;
   margin: 1.5rem 0;
   border: 2px solid rgba(255, 215, 0, 0.3);
  }
  
  p {
   font-size: 1.4rem;
   line-height: 1.8;
   min-height: 100px;
  }
  
  .back-button, .btn-game { 
   margin: 0.5rem;
   background: linear-gradient(135deg, gold 0%, #ffed4e 100%);
   color: darkred;
   border: 2px solid rgba(139, 0, 0, 0.5);
   font-weight: bold;
   font-size: 1.2rem;
   padding: 0.7rem 2rem;
   border-radius: 50px;
   transition: all 0.3s ease;
   box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
   cursor: pointer;
  }
  
  .back-button:hover, .btn-game:hover { 
   transform: translateY(-3px) scale(1.05);
   box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
   background: linear-gradient(135deg, #ffed4e 0%, gold 100%);
  }
  
  .btn-game:active { 
   transform: translateY(-1px);
  }
  
  #result-area {
   margin-top: 2rem;
   min-height: 100px;
  }
  
  .emoji-sparkle {
   display: inline-block;
   animation: sparkle 1.5s ease-in-out infinite;
  }
  
  @keyframes sparkle {
   0%, 100% { transform: scale(1) rotate(0deg); }
   50% { transform: scale(1.2) rotate(180deg); }
  }
  
  .result-message {
   font-size: 1.6rem;
   padding: 1.5rem;
   border-radius: 15px;
   margin-top: 1rem;
   animation: fadeInUp 0.5s ease-out;
  }
  
  @keyframes fadeInUp {
   from { opacity: 0; transform: translateY(20px); }
   to { opacity: 1; transform: translateY(0); }
  }
  
  .success-message {
   color: #90EE90;
   text-shadow: 0 0 10px rgba(144, 238, 144, 0.5);
  }
  
  .punch-message { 
   color: #FFD700;
   text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }
  
  .lab-icon {
   font-size: 2rem;
   margin: 0 0.3rem;
   display: inline-block;
   animation: float-icon 3s ease-in-out infinite;
  }
  
  @keyframes float-icon {
   0%, 100% { transform: translateY(0); }
   50% { transform: translateY(-10px); }
  }

  .crossword-container {
      margin-top: 2rem;
      display: none;
      width: 100%;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
  }

  .crossword-grid {
      display: grid;
      gap: 1px;
      border: 2px solid gold;
      margin: 1rem auto;
      background-color: rgba(0, 0, 0, 0.7);
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
  }

  .grid-cell {
      position: relative;
      width: 40px;
      height: 40px;
      background-color: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
  }

  .grid-cell.active-cell {
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
  }

  .grid-cell.empty-cell {
      background-color: transparent !important;
      border: none !important;
      box-shadow: none !important;
      pointer-events: none;
  }

  .grid-cell input {
      width: 100%;
      height: 100%;
      border: none;
      background-color: transparent;
      color: #fff;
      font-size: 1.5rem;
      text-align: center;
      text-transform: uppercase;
      padding: 0;
      box-sizing: border-box;
      outline: none;
  }

  .grid-cell input:focus {
      background-color: rgba(255, 255, 255, 0.2);
  }

  .grid-cell input.correct {
      background-color: rgba(144, 238, 144, 0.3) !important;
      color: #90EE90 !important;
  }

  .grid-cell input:disabled {
      cursor: not-allowed;
  }

  .clue-number {
      position: absolute;
      top: 2px;
      left: 2px;
      font-size: 0.7rem;
      color: gold;
      font-weight: bold;
      z-index: 2;
  }

  .clues-section {
      display: flex;
      justify-content: space-around;
      margin-top: 2rem;
      flex-wrap: wrap;
      gap: 2rem;
  }

  .clues-section h3 {
      color: gold;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      margin-bottom: 1rem;
      font-size: 1.8rem;
  }

  .clues-list {
      text-align: left;
      list-style-type: none;
      padding: 0;
      margin: 0;
  }

  .clues-list li {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
  }

  .crossword-buttons {
      margin-top: 2rem;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
  }

  #videoOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.95);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1500;
  }

  #videoPlayer {
    max-width: 90vw;
    max-height: 90vh;
    border: 5px solid gold;
    border-radius: 10px;
  }
 </style>
</head>
<body>
 <!-- Audio elements -->
 <audio id="sound-track" loop preload="auto">
  <source src="audio/greys.mp3" type="audio/mpeg"> 
 </audio>
 <div id="videoOverlay">
    <video id="videoPlayer" controls preload="auto">
        Il tuo browser non supporta il tag video.
    </video>
 </div>
 <div class="content-box">
  <h1>
   <span class="emoji-sparkle">ü©∫</span> 
   Giorno 8 - Cruciverba Grey's Anatomy 
   <span class="emoji-sparkle">üè•</span>
  </h1>
  <div class="message-container" id="intro-message">
   <p>
    Benvenuta, Bibi nel cruciverba a tema Grey's Anatomy! Metti alla prova la tua conoscenza del Grey Sloan Memorial e dei suoi dottori.
    Quando sei pronta, clicca su "Inizia il Gioco" e risolvi le domande. In bocca al lupo! ‚ù§Ô∏è
   </p>
  </div>
<button class="btn btn-game" id="startGameButton">Inizia il Gioco ‚ú®</button>
  <div class="crossword-container" id="crosswordGame">
   <div class="crossword-grid" id="crosswordGrid">
    <!-- Crossword grid cells will be inserted here by JavaScript -->
   </div>
   <div class="clues-section">
    <div>
        <h3>Orizzontale</h3>
        <ul class="clues-list" id="horizontal-clues">
            <!-- Horizontal clues will be inserted here by JavaScript -->
        </ul>
    </div>
    <div>
        <h3>Verticale</h3>
        <ul class="clues-list" id="vertical-clues">
            <!-- Vertical clues will be inserted here by JavaScript -->
        </ul>
    </div>
   </div>
   <div class="crossword-buttons">
    <button class="btn btn-game" id="checkAnswersButton">Controlla Risposte ‚úÖ</button>
    <button class="btn btn-game" id="resetGameButton">Resetta Gioco üîÑ</button>
   </div>
  </div>
  <div id="result-area"></div>
  <a href="index.html" class="btn back-button" id="back-to-calendar" style="display: none;">üéÑ Torna al Calendario
</a>
 </div>
 <script>
  // Funzione per creare fiocchi di neve
  function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      snowflake.textContent = '‚ùÑ';
      snowflake.style.left = Math.random() * 100 + '%';
      snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
      snowflake.style.opacity = Math.random() * 0.5 + 0.5;
      snowflake.style.fontSize = (Math.random() * 20 + 10) + 'px';
      document.body.appendChild(snowflake);
      
      setTimeout(() => snowflake.remove(), 8000);
  }

  const soundtrack = document.getElementById('sound-track');
  const videoPlayer = document.getElementById('videoPlayer');
  const videoOverlay = document.getElementById('videoOverlay');
  const introVideoSrc = 'video/video.mp4';
  const winVideoSrc = 'video/video1.mp4';
  
  const startGameButton = document.getElementById('startGameButton');
  const crosswordGame = document.getElementById('crosswordGame');
  const crosswordGridElement = document.getElementById('crosswordGrid');
  const horizontalCluesElement = document.getElementById('horizontal-clues');
  const verticalCluesElement = document.getElementById('vertical-clues');
  const checkAnswersButton = document.getElementById('checkAnswersButton');
  const resetGameButton = document.getElementById('resetGameButton');
  const resultArea = document.getElementById('result-area');
  const backButton = document.getElementById('back-to-calendar');
  const introMessage = document.getElementById('intro-message');

  // Dati per le parole del cruciverba
  const wordsData = [
    // Orizzontali
    { clue: "5. La neurochirurga, sorella di Derek, con un passato difficile e un'iconica frase 'It's a beautiful day to save lives'.", answer: "AMELIA", startRow: 2, startCol: 0, direction: "H", clueNum: 5 },
    { clue: "7. La specializzazione della dottoressa Callie Torres, spesso coinvolta in casi complessi di ossa e protesi.", answer: "ORTOPEDIA", startRow: 6, startCol: 1, direction: "H", clueNum: 7 },
    { clue: "9. Il cognome della dottoressa che Meredith definisce 'la sua persona', una cardiologa di talento e cinica, con cui ha un legame profondo.", answer: "YANG", startRow: 8, startCol: 9, direction: "H", clueNum: 9 },
    { clue: "11. Il chirurgo cardiotoracico dal carattere difficile, ex mentore e primo marito di Cristina, famoso per la sua perfezione.", answer: "BURKE", startRow: 9, startCol: 2, direction: "H", clueNum: 11 },
    { clue: "12. La primogenita adottiva di Meredith e Derek, un nome di origine africana che significa 'essere speciale'.", answer: "ZOLA", startRow: 12, startCol: 8, direction: "H", clueNum: 12 },

    // Verticali
    { clue: "1. Il cognome del neurochirurgo 'McDreamy', amore di Meredith, il cui destino ha spezzato molti cuori e ha ispirato un soprannome iconico.", answer: "SHEPHERD", startRow: 0, startCol: 2, direction: "V", clueNum: 1 },
    { clue: "2. Il nome dell'ospedale prima di essere rinominato Grey Sloan ______ Memorial, in onore di due medici tragicamente scomparsi.", answer: "GRACE", startRow: 0, startCol: 5, direction: "V", clueNum: 2 },
    { clue: "3. Il cognome del dottore pediatrico, poi capo di chirurgia, marito di Jo, con un passato difficile e un'evoluzione sorprendente.", answer: "KAREV", startRow: 1, startCol: 0, direction: "V", clueNum: 3 },
    { clue: "4. Il soprannome di Marc Sloan", answer: "MCSTEAMY", startRow: 1, startCol: 9, direction: "V", clueNum: 4 },
    { clue: "6. Il primario di chirurgia per gran parte delle stagioni, poi capo del programma di specializzazione, mentore e figura paterna per molti specializzandi.", answer: "WEBBER", startRow: 5, startCol: 6, direction: "V", clueNum: 6 },
    { clue: "8. Il cognome del capo di chirurgia traumatica, con un passato militare e un rapporto tormentato con Cristina Yang, noto per le sue decisioni impulsive.", answer: "HUNT", startRow: 8, startCol: 3, direction: "V", clueNum: 8 },
    { clue: "10. La dottoressa specializzata in chirurgia plastica, ex moglie di Jackson Avery, nota per la sua fede e le sue lotte personali.", answer: "APRIL", startRow: 8, startCol: 10, direction: "V", clueNum: 10 }
  ];

  const GRID_ROWS = 13;
  const GRID_COLS = 13;

  // Inizializza la griglia con null per le celle vuote
  const gridData = Array(GRID_ROWS).fill(null).map(() => Array(GRID_COLS).fill(null));

  // Popola gridData con le parole e i numerini delle definizioni
  wordsData.forEach(wordObj => {
      for (let i = 0; i < wordObj.answer.length; i++) {
          let r = wordObj.startRow;
          let c = wordObj.startCol;
          if (wordObj.direction === "H") {
              c += i;
          } else {
              r += i;
          }

          if (r >= 0 && r < GRID_ROWS && c >= 0 && c < GRID_COLS) {
              if (!gridData[r][c]) {
                  gridData[r][c] = { letter: '', clueH: null, clueV: null };
              }
              gridData[r][c].letter = wordObj.answer[i];

              if (i === 0) {
                  if (wordObj.direction === "H") {
                      gridData[r][c].clueH = wordObj.clueNum;
                  } else {
                      gridData[r][c].clueV = wordObj.clueNum;
                  }
              }
          } else {
              console.warn(`Parola '${wordObj.answer}' (Clue ${wordObj.clueNum}) esce dai bordi della griglia a riga ${r}, colonna ${c}.`);
          }
      }
  });

  function renderClues() {
      horizontalCluesElement.innerHTML = '';
      verticalCluesElement.innerHTML = '';

      wordsData.filter(w => w.direction === "H").sort((a, b) => a.clueNum - b.clueNum).forEach(w => {
          const li = document.createElement('li');
          li.textContent = w.clue;
          horizontalCluesElement.appendChild(li);
      });

      wordsData.filter(w => w.direction === "V").sort((a, b) => a.clueNum - b.clueNum).forEach(w => {
          const li = document.createElement('li');
          li.textContent = w.clue;
          verticalCluesElement.appendChild(li);
      });
  }

  function renderCrosswordGrid() {
    crosswordGridElement.innerHTML = '';
    crosswordGridElement.style.gridTemplateColumns = `repeat(${GRID_COLS}, 40px)`;
    crosswordGridElement.style.gridTemplateRows = `repeat(${GRID_ROWS}, 40px)`;

    for (let r = 0; r < GRID_ROWS; r++) {
        for (let c = 0; c < GRID_COLS; c++) {
            const cellDiv = document.createElement('div');
            cellDiv.classList.add('grid-cell');

            const cellData = gridData[r][c];

            if (!cellData || cellData.letter === '') {
                cellDiv.classList.add('empty-cell');
                crosswordGridElement.appendChild(cellDiv);
                continue;
            }

            cellDiv.classList.add('active-cell');

            const input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 1;
            input.id = `cell-${r}-${c}`;
            input.dataset.row = r;
            input.dataset.col = c;
            
            cellDiv.appendChild(input);

            if (cellData.clueH !== null || cellData.clueV !== null) {
                const clueSpan = document.createElement('span');
                clueSpan.classList.add('clue-number');
                clueSpan.textContent = cellData.clueH || cellData.clueV; 
                cellDiv.appendChild(clueSpan);
            }

            crosswordGridElement.appendChild(cellDiv);
        }
    }
  }

  function startGame() {
    introMessage.style.display = 'none';
    startGameButton.style.display = 'none';
    
    // Ferma e resetta la musica
    soundtrack.pause();
    soundtrack.currentTime = 0;
    
    // Mostra video introduttivo
    videoOverlay.style.display = 'flex';
    videoPlayer.src = introVideoSrc;
    videoPlayer.load();
    
    // Flag per avviare la musica una sola volta
    let musicStarted = false;
    
    // Listener per controllare il tempo del video
    videoPlayer.addEventListener('timeupdate', function checkTime() {
        if (!musicStarted && videoPlayer.currentTime >= 25) {
            musicStarted = true;
            soundtrack.volume = 0.3;
            soundtrack.play().catch(e => console.log("Audio play prevented:", e));
            videoPlayer.removeEventListener('timeupdate', checkTime);
        }
    });
    
    videoPlayer.play().catch(e => console.error("Error playing intro video:", e));

    videoPlayer.onended = () => {
        videoOverlay.style.display = 'none';
        startActualGame();
    };
}

function startActualGame() {
    crosswordGame.style.display = 'block';
    renderCrosswordGrid();
    renderClues();
    
    // La musica √® gi√† partita dopo 25 secondi, quindi non serve riavviarla
    // Se per qualche motivo non sta suonando, riavviala
    if (soundtrack.paused) {
        soundtrack.volume = 0.3;
        soundtrack.play().catch(e => console.log("Audio play prevented:", e));
    }
}



  function checkAnswers() {
    let correctCellsCount = 0;
    let totalExpectedCells = 0;
    resultArea.innerHTML = '';

    const inputCells = document.querySelectorAll('.crossword-grid input');
    inputCells.forEach(input => {
      const r = parseInt(input.dataset.row);
      const c = parseInt(input.dataset.col);
      
      const cellData = gridData[r][c];
      
      if (cellData && cellData.letter !== '') {
          totalExpectedCells++;
          if (input.value.toUpperCase().trim() === cellData.letter) {
            input.classList.add('correct');
            input.disabled = true;
            correctCellsCount++;
          } else {
            if (!input.classList.contains('correct')) { 
                input.classList.remove('correct'); 
                input.value = '';
                input.disabled = false;
            }
          }
      }
    });

    if (correctCellsCount === totalExpectedCells) {
      soundtrack.pause();
      soundtrack.currentTime = 0;
      
      // Mostra video finale (video1.mp4)
      videoOverlay.style.display = 'flex';
      videoPlayer.src = winVideoSrc;
      videoPlayer.load();
      videoPlayer.play().catch(e => console.error("Error playing win video:", e));

      videoPlayer.onended = () => {
        videoOverlay.style.display = 'none';
        resultArea.innerHTML = `
          <div class="result-message success-message">
           <span class="lab-icon">üéâ</span>
           Complimenti Mapi! Hai completato il cruciverba a tema Grey's Anatomy!
           <span class="lab-icon">ü•≥</span>
          </div>
        `;
        backButton.style.display = 'inline-block';
        checkAnswersButton.style.display = 'none';
        resetGameButton.style.display = 'none';
      };
    } else {
      resultArea.innerHTML = `
        <div class="result-message punch-message">
         <span class="lab-icon">ü§î</span>
         Hai ${correctCellsCount} lettere corrette su ${totalExpectedCells}. Continua cos√¨, Bibi!
         <span class="lab-icon">üí°</span>
        </div>
      `;
    }
  }

  function resetGame() {
    renderCrosswordGrid(); 
    resultArea.innerHTML = '';
    soundtrack.currentTime = 0;
    soundtrack.play().catch(e => console.log("Audio play prevented:", e));
    checkAnswersButton.style.display = 'inline-block';
    resetGameButton.style.display = 'inline-block';
    backButton.style.display = 'none';
  }

  startGameButton.addEventListener('click', startGame);
  checkAnswersButton.addEventListener('click', checkAnswers);
  resetGameButton.addEventListener('click', resetGame);



  document.addEventListener('DOMContentLoaded', () => {
    setInterval(createSnowflake, 300);
  });

 </script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>