<!DOCTYPE html>
<html lang="it">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>Giorno 11 - Ruota della Fortuna! ðŸŽ¡</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap" rel="stylesheet">
 <style>
  * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
  }
  
  body {
   font-family: 'Mountains of Christmas', cursive;
   background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
   color: #fff;
   min-height: 100vh;
   display: flex;
   flex-direction: column;
   justify-content: center;
   align-items: center;
   padding: 2rem;
   position: relative;
   overflow-x: hidden;
   overflow-y: auto;
  }
  
  body::before {
   content: '';
   position: fixed;
   width: 100%;
   height: 100%;
   background-image: 
    radial-gradient(2px 2px at 20% 30%, white, transparent),
    radial-gradient(2px 2px at 60% 70%, white, transparent),
    radial-gradient(1px 1px at 50% 50%, white, transparent),
    radial-gradient(1px 1px at 80% 10%, white, transparent),
    radial-gradient(2px 2px at 90% 60%, white, transparent),
    radial-gradient(1px 1px at 33% 80%, white, transparent),
    radial-gradient(1px 1px at 75% 40%, white, transparent);
   background-size: 200% 200%;
   animation: float 20s ease-in-out infinite;
   opacity: 0.3;
   z-index: 0;
  }
  
  @keyframes float {
   0%, 100% { transform: translateY(0); }
   50% { transform: translateY(-20px); }
  }

  .snowflake {
   position: fixed;
   top: -10px;
   color: white;
   font-size: 1em;
   font-family: Arial, sans-serif;
   text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
   z-index: 0;
   user-select: none;
   pointer-events: none;
   animation: fall linear infinite;
  }
  
  @keyframes fall {
   to {
    transform: translateY(100vh) translateX(100px);
    opacity: 0;
   }
  }
  
  .content-box {
   background: linear-gradient(135deg, rgba(139, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.95) 100%);
   border: 5px solid;
   border-image: linear-gradient(45deg, gold, #ffed4e, gold) 1;
   border-radius: 25px;
   padding: 3rem;
   max-width: 900px;
   text-align: center;
   box-shadow: 
    0 0 30px rgba(255, 215, 0, 0.3),
    0 0 60px rgba(255, 215, 0, 0.2),
    inset 0 0 50px rgba(0, 0, 0, 0.5);
   position: relative;
   z-index: 1;
   animation: glow-pulse 3s ease-in-out infinite;
  }
  
  @keyframes glow-pulse {
   0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 60px rgba(255, 215, 0, 0.2), inset 0 0 50px rgba(0, 0, 0, 0.5); }
   50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.5), 0 0 80px rgba(255, 215, 0, 0.3), inset 0 0 50px rgba(0, 0, 0, 0.5); }
  }
  
  h1 {
   color: gold;
   text-shadow: 
    2px 2px 4px black,
    0 0 20px rgba(255, 215, 0, 0.5),
    0 0 30px rgba(255, 215, 0, 0.3);
   font-size: 2.8rem;
   margin-bottom: 2rem;
   animation: title-glow 2s ease-in-out infinite alternate;
  }
  
  @keyframes title-glow {
   from { text-shadow: 2px 2px 4px black, 0 0 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.3); }
   to { text-shadow: 2px 2px 4px black, 0 0 30px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.5); }
  }
  
  .message-container {
   background: rgba(0, 0, 0, 0.4);
   border-radius: 15px;
   padding: 2rem;
   margin: 1.5rem 0;
   border: 2px solid rgba(255, 215, 0, 0.3);
  }
  
  p {
   font-size: 1.4rem;
   line-height: 1.8;
  }
  
  .btn-game { 
   margin: 0.5rem;
   background: linear-gradient(135deg, gold 0%, #ffed4e 100%);
   color: darkred;
   border: 2px solid rgba(139, 0, 0, 0.5);
   font-weight: bold;
   font-size: 1.2rem;
   padding: 0.7rem 2rem;
   border-radius: 50px;
   transition: all 0.3s ease;
   box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
   cursor: pointer;
  }
  
  .btn-game:hover { 
   transform: translateY(-3px) scale(1.05);
   box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
   background: linear-gradient(135deg, #ffed4e 0%, gold 100%);
  }

  .btn-game:disabled {
   opacity: 0.5;
   cursor: not-allowed;
   transform: none;
  }
  
  .wheel-container {
   display: none;
   margin: 2rem auto;
   position: relative;
   width: 400px;
   height: 400px;
  }

  .wheel-pointer {
   position: absolute;
   top: -30px;
   left: 50%;
   transform: translateX(-50%);
   width: 0;
   height: 0;
   border-left: 20px solid transparent;
   border-right: 20px solid transparent;
   border-top: 40px solid gold;
   z-index: 10;
   filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
  }

  #wheelCanvas {
   border: 5px solid gold;
   border-radius: 50%;
   box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
   background: #000;
  }

  .result-display {
   margin-top: 2rem;
   padding: 2rem;
   background: rgba(0, 0, 0, 0.6);
   border: 3px solid gold;
   border-radius: 15px;
   min-height: 150px;
   display: none;
  }

  .result-display h2 {
   color: gold;
   font-size: 2rem;
   margin-bottom: 1rem;
   text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
  }

  .result-display p {
   font-size: 1.3rem;
   color: #fff;
   line-height: 1.6;
  }

  .prize-counter {
   margin-top: 1rem;
   font-size: 1.5rem;
   color: gold;
   text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  .back-button {
   margin-top: 2rem;
   display: none;
   background: linear-gradient(135deg, gold 0%, #ffed4e 100%);
   color: darkred;
   border: 2px solid rgba(139, 0, 0, 0.5);
   font-weight: bold;
   font-size: 1.2rem;
   padding: 0.7rem 2rem;
   border-radius: 50px;
   transition: all 0.3s ease;
   box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
   text-decoration: none;
  }

  .back-button:hover {
   transform: translateY(-3px) scale(1.05);
   box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
  }

  .emoji-sparkle {
   display: inline-block;
   animation: sparkle 1.5s ease-in-out infinite;
  }
  
  @keyframes sparkle {
   0%, 100% { transform: scale(1) rotate(0deg); }
   50% { transform: scale(1.2) rotate(180deg); }
  }
 </style>
</head>
<body>
 <audio id="game-music" loop preload="auto">
  <source src="audio/blue.mp3" type="audio/mpeg"> 
 </audio>
 <audio id="spin-sound" preload="auto">
  <source src="audio/up.mp3" type="audio/mpeg">
 </audio>
 <audio id="win-sound" preload="auto">
  <source src="audio/corretta.mp3" type="audio/mpeg">
 </audio>
 <div class="content-box">
  <h1>
   <span class="emoji-sparkle">ðŸŽ¡</span> 
   Ruota della Fortuna! 
   <span class="emoji-sparkle">ðŸŽ°</span>
  </h1>
  <div class="message-container" id="intro-message">
   <p>
    Benvenuta alla Ruota della Fortuna! 
    Gira la ruota per scoprire cosa ti aspetta... premi, sfide e qualche sorpresa!
    Fai 3 giri e vedi cosa ti capita! ðŸŽ²
   </p>
  </div>
<button class="btn btn-game" id="startGameButton">Inizia il Gioco! âœ¨</button>
  <div class="wheel-container" id="wheelContainer">
   <div class="wheel-pointer"></div>
   <canvas id="wheelCanvas" width="400" height="400"></canvas>
  </div>
<button class="btn btn-game" id="spinButton" style="display: none;">Gira la Ruota! ðŸŽ¡</button>
  <div class="prize-counter" id="prizeCounter" style="display: none;">
   Giri effettuati: <span id="spinCount">0</span> / 3
  </div>
  <div class="result-display" id="resultDisplay">
   <h2 id="resultTitle"></h2>
   <p id="resultMessage"></p>
  </div>
  <a href="index.html" class="btn back-button" id="backButton">
   ðŸŽ„ Torna al Calendario
  </a>
 </div>
 <script>
  function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      snowflake.textContent = 'â„';
      snowflake.style.left = Math.random() * 100 + '%';
      snowflake.style.animationDuration = (Math.random() * 3 + 5) + 's';
      snowflake.style.opacity = Math.random() * 0.5 + 0.5;
      snowflake.style.fontSize = (Math.random() * 20 + 10) + 'px';
      document.body.appendChild(snowflake);
      
      setTimeout(() => snowflake.remove(), 8000);
  }

  const gameMusic = document.getElementById('game-music');
  const spinSound = document.getElementById('spin-sound');
  const winSound = document.getElementById('win-sound');
  
  const startGameButton = document.getElementById('startGameButton');
  const wheelContainer = document.getElementById('wheelContainer');
  const spinButton = document.getElementById('spinButton');
  const resultDisplay = document.getElementById('resultDisplay');
  const resultTitle = document.getElementById('resultTitle');
  const resultMessage = document.getElementById('resultMessage');
  const prizeCounter = document.getElementById('prizeCounter');
  const spinCountDisplay = document.getElementById('spinCount');
  const backButton = document.getElementById('backButton');
  const introMessage = document.getElementById('intro-message');

  const canvas = document.getElementById('wheelCanvas');
  const ctx = canvas.getContext('2d');

  let currentRotation = 0;
  let isSpinning = false;
  let spinCount = 0;
  const maxSpins = 3;

  // Premi della ruota (8 settori)
  const prizes = [
    { text: "Pizza insieme", message: "Ti offro una pizza! Scegli tu la pizzeria, ma niente ananas! ðŸ•", color: "#FF1744" },
    { text: "Film a scelta", message: "Serata cinema! Tu scegli il film, io porto i popcorn ðŸ¿", color: "#E91E63" },
    { text: "Pugnetto", message: "Ops! Ti sei beccata un pugnetto affettuoso! ðŸ‘Š (Non fa male, promesso)", color: "#9C27B0" },
    { text: "Massaggio", message: "Un massaggio rilassante di 15 minuti! Schiena o piedi? ðŸ’†", color: "#673AB7" },
    { text: "Colazione a letto", message: "Colazione a letto nel weekend! Con caffÃ¨ e cornetti ðŸ¥â˜•", color: "#3F51B5" },
    { text: "Serata gaming", message: "Una serata a giocare insieme! Tu scegli il gioco ðŸŽ®", color: "#2196F3" },
    { text: "CorvÃ©e gratis", message: "Ti salvi da una corvÃ©e a tua scelta! Valido per 1 volta ðŸŽ«", color: "#00BCD4" },
    { text: "Gelato",message: "Ti offro un gelato! Anche con 2 gusti e panna! ðŸ¦", color: "#009688" }
  ];

  function drawWheel() {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 180;
    const sliceAngle = (2 * Math.PI) / prizes.length;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Disegna i settori
    prizes.forEach((prize, index) => {
      const startAngle = index * sliceAngle + currentRotation;
      const endAngle = startAngle + sliceAngle;

      // Settore colorato
      ctx.beginPath();
      ctx.moveTo(centerX, centerY);
      ctx.arc(centerX, centerY, radius, startAngle, endAngle);
      ctx.closePath();
      ctx.fillStyle = prize.color;
      ctx.fill();
      ctx.strokeStyle = 'gold';
      ctx.lineWidth = 3;
      ctx.stroke();

      // Testo
      ctx.save();
      ctx.translate(centerX, centerY);
      ctx.rotate(startAngle + sliceAngle / 2);
      ctx.textAlign = 'center';
      ctx.fillStyle = '#fff';
      ctx.font = 'bold 16px "Mountains of Christmas"';
      ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
      ctx.shadowBlur = 4;
      ctx.fillText(prize.text, radius / 1.5, 10);
      ctx.restore();
    });

    // Centro della ruota
    ctx.beginPath();
    ctx.arc(centerX, centerY, 30, 0, 2 * Math.PI);
    ctx.fillStyle = 'gold';
    ctx.fill();
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 3;
    ctx.stroke();
  }

  function startGame() {
    introMessage.style.display = 'none';
    startGameButton.style.display = 'none';
    wheelContainer.style.display = 'block';
    spinButton.style.display = 'inline-block';
    prizeCounter.style.display = 'block';
    
    gameMusic.volume = 0.3;
    gameMusic.play().catch(e => console.log("Audio play prevented:", e));
    
    drawWheel();
  }

  function spinWheel() {
    if (isSpinning) return;
    
    isSpinning = true;
    spinButton.disabled = true;
    resultDisplay.style.display = 'none';

    spinSound.currentTime = 0;
    spinSound.play().catch(e => console.log("Spin sound prevented:", e));

    // Rotazione casuale (almeno 5 giri completi + angolo casuale)
    const spins = 5 + Math.random() * 3;
    const extraDegrees = Math.random() * 360;
    const totalRotation = (spins * 360 + extraDegrees) * Math.PI / 180;
    
    const duration = 4000; // 4 secondi
    const startTime = Date.now();
    const startRotation = currentRotation;

    function animate() {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // Easing per rallentamento
      const easeOut = 1 - Math.pow(1 - progress, 3);
      
      currentRotation = startRotation + totalRotation * easeOut;
      drawWheel();

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        finishSpin();
      }
    }

    animate();
  }

  function finishSpin() {
    isSpinning = false;
    
    // Normalizza la rotazione
    currentRotation = currentRotation % (2 * Math.PI);
    
    // CORREZIONE: Calcola quale premio Ã¨ sotto la freccia (che punta in alto)
    const sliceAngle = (2 * Math.PI) / prizes.length;
    
    // La freccia punta verso l'alto (angolo -Math.PI/2 o 3*Math.PI/2)
    // Dobbiamo trovare quale settore si trova in quella posizione
    let pointerAngle = Math.PI / 2; // 90 gradi = parte superiore
    
    // Sottrai la rotazione corrente per trovare la posizione relativa
    let relativeAngle = pointerAngle - currentRotation;
    
    // Normalizza l'angolo tra 0 e 2*PI
    while (relativeAngle < 0) relativeAngle += 2 * Math.PI;
    relativeAngle = relativeAngle % (2 * Math.PI);
    
    // Calcola quale settore corrisponde a questo angolo
    const prizeIndex = Math.floor(relativeAngle / sliceAngle) % prizes.length;
    
    const wonPrize = prizes[prizeIndex];

    winSound.currentTime = 0;
    winSound.play().catch(e => console.log("Win sound prevented:", e));

    // Mostra risultato
    resultDisplay.style.display = 'block';
    resultTitle.textContent = `ðŸŽ‰ ${wonPrize.text}! ðŸŽ‰`;
    resultMessage.textContent = wonPrize.message;

    spinCount++;
    spinCountDisplay.textContent = spinCount;

    if (spinCount >= maxSpins) {
      endGame();
    } else {
      setTimeout(() => {
        spinButton.disabled = false;
      }, 2000);
    }
  }

  function endGame() {
    spinButton.style.display = 'none';
    gameMusic.pause();
    gameMusic.currentTime = 0;

    resultDisplay.style.display = 'block';
    resultTitle.textContent = 'ðŸŽŠ Hai completato tutti i giri! ðŸŽŠ';
    resultMessage.innerHTML = `
      Bene! Hai finito i giri della ruota! 
      <br><br>
      Spero ti siano piaciuti i premi... alcuni piÃ¹ di altri! ðŸ˜„
      <br>
      Ricordati che devi riscuoterli tutti! ðŸŽ
    `;
    backButton.style.display = 'inline-block';
  }

  startGameButton.addEventListener('click', startGame);
  spinButton.addEventListener('click', spinWheel);

  document.addEventListener('DOMContentLoaded', () => {
    setInterval(createSnowflake, 300);
  });

 </script>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>