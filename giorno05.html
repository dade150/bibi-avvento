<!DOCTYPE html>
<html lang="it">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Giorno 5 - Trova gli Oggetti Nascosti</title>
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
 <style>
  /* Stili globali dal giorno 2/3 */
  * {
   margin: 0;
   padding: 0;
   box-sizing: border-box;
  }
  
  body {
   font-family: 'Mountains of Christmas', cursive;
   background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
   color: #fff;
   min-height: 100vh;
   display: flex;
   flex-direction: column;
   justify-content: center;
   align-items: center;
   padding: 2rem;
   position: relative;
  }
  
  body::before {
   content: '';
   position: absolute;
   width: 100%;
   height: 100%;
   background-image: 
    radial-gradient(2px 2px at 20% 30%, white, transparent),
    radial-gradient(2px 2px at 60% 70%, white, transparent),
    radial-gradient(1px 1px at 50% 50%, white, transparent),
    radial-gradient(1px 1px at 80% 10%, white, transparent),
    radial-gradient(2px 2px at 90% 60%, white, transparent),
    radial-gradient(1px 1px at 33% 80%, white, transparent),
    radial-gradient(1px 1px at 75% 40%, white, transparent);
   background-size: 200% 200%;
   animation: float 20s ease-in-out infinite;
   opacity: 0.3;
  }
  
  @keyframes float {
   0%, 100% { transform: translateY(0); }
   50% { transform: translateY(-20px); }
  }

  .hidden-objects-game-container {
   flex: 1;
   display: flex;
   flex-direction: column;
   align-items: center;
   justify-content: center;
   width: 100%;
   max-width: 1000px; /* Larghezza massima del gioco */
   z-index: 1;
   padding: 2rem;
   background: linear-gradient(135deg, rgba(139, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.95) 100%);
   border: 5px solid;
   border-image: linear-gradient(45deg, gold, #ffed4e, gold) 1;
   border-radius: 25px;
   box-shadow: 
    0 0 30px rgba(255, 215, 0, 0.3),
    0 0 60px rgba(255, 215, 0, 0.2),
    inset 0 0 50px rgba(0, 0, 0, 0.5);
   animation: glow-pulse 3s ease-in-out infinite;
  }
  
  @keyframes glow-pulse {
   0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 60px rgba(255, 215, 0, 0.2), inset 0 0 50px rgba(0, 0, 0, 0.5); }
   50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.5), 0 0 80px rgba(255, 215, 0, 0.3), inset 0 0 50px rgba(0, 0, 0, 0.5); }
  }

  .game-header {
   text-align: center;
   margin-bottom: 2rem;
  }

  .game-header h1 {
   color: gold;
   font-size: 2.8rem;
   text-shadow: 
    2px 2px 4px black,
    0 0 20px rgba(255, 215, 0, 0.5),
    0 0 30px rgba(255, 215, 0, 0.3);
   margin-bottom: 1rem;
   animation: title-glow 2s ease-in-out infinite alternate;
  }
  
  @keyframes title-glow {
   from { text-shadow: 2px 2px 4px black, 0 0 20px rgba(255, 215, 0, 0.5), 0 0 30px rgba(255, 215, 0, 0.3); }
   to { text-shadow: 2px 2px 4px black, 0 0 30px rgba(255, 215, 0, 0.8), 0 0 50px rgba(255, 215, 0, 0.5); }
  }

  .game-content {
   display: flex;
   flex-direction: column; /* Cambiato in colonna per layout mobile */
   gap: 1.5rem;
   width: 100%;
   align-items: center;
  }

  .game-scene-wrapper {
   position: relative;
   width: 100%;
   max-width: 700px; /* Larghezza massima dell'immagine di gioco */
   border: 3px solid gold;
   border-radius: 10px;
   overflow: hidden;
   cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewport="0 0 100 100" style="fill:black;font-size:18px;"><text y="50%">üîç</text></svg>') 15 15, auto; /* Cursore a lente */
  }

  .game-scene-wrapper img {
   width: 100%;
   height: auto;
   display: block;
  }

  .hidden-object-highlight {
   position: absolute;
   border: 2px solid #00ff00; /* Bordo verde per oggetti trovati */
   background-color: rgba(0, 255, 0, 0.2); /* Sfondo semi-trasparente */
   border-radius: 5px;
   pointer-events: none; /* Non blocca il clic sull'immagine sottostante */
   opacity: 0; /* Inizialmente invisibile */
   transition: opacity 0.3s ease;
  }

  .hidden-object-highlight.found {
   opacity: 1; /* Rendi visibile quando trovato */
  }

  .object-list-container {
   width: 100%;
   max-width: 300px; /* Larghezza della lista oggetti */
   background: rgba(0, 0, 0, 0.4);
   border: 2px solid rgba(255, 215, 0, 0.3);
   border-radius: 15px;
   padding: 1rem;
   text-align: center;
  }

  .object-list-container h3 {
   color: gold;
   font-size: 1.5rem;
   margin-bottom: 1rem;
   text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
  }

  #objects-to-find {
   list-style: none;
   padding: 0;
   margin: 0;
  }

  #objects-to-find li {
   font-size: 1.1rem;
   color: #fff;
   padding: 0.5rem 0;
   border-bottom: 1px dashed rgba(255, 215, 0, 0.2);
   transition: color 0.3s ease, text-decoration 0.3s ease;
  }

  #objects-to-find li:last-child {
   border-bottom: none;
  }

  #objects-to-find li.found {
   color: #00ff00; /* Verde per oggetti trovati */
   text-decoration: line-through;
   opacity: 0.7;
  }

  .game-info {
   margin-top: 1.5rem;
   font-size: 1.2rem;
   color: gold;
   text-align: center;
  }
  .game-info span {
    font-weight: bold;
  }

  .game-buttons {
   margin-top: 2rem;
   display: flex;
   gap: 1rem;
   justify-content: center;
   flex-wrap: wrap; /* Per layout responsivo */
  }

  .game-button {
   padding: 1rem 2rem;
   font-size: 1.2rem;
   font-family: 'Mountains of Christmas', cursive;
   background: linear-gradient(135deg, gold 0%, #ffed4e 100%);
   color: darkred;
   border: 2px solid rgba(139, 0, 0, 0.5);
   border-radius: 50px;
   cursor: pointer;
   transition: all 0.3s ease;
   font-weight: bold;
   box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
  }

  .game-button:hover {
   transform: translateY(-3px) scale(1.05);
   box-shadow: 0 6px 25px rgba(255, 215, 0, 0.6);
   background: linear-gradient(135deg, #ffed4e 0%, gold 100%);
  }

  /* Game Over/Win Modal */
  .game-modal {
   display: none; /* Hidden by default */
   position: fixed; /* Stay in place */
   z-index: 100; /* Sit on top */
   left: 0;
   top: 0;
   width: 100%; /* Full width */
   height: 100%; /* Full height */
   overflow: auto; /* Enable scroll if needed */
   background-color: rgba(0,0,0,0.8); /* Black w/ opacity */
   justify-content: center;
   align-items: center;
   flex-direction: column;
  }

  .game-modal-content {
   background-color: #0a0a0a;
   margin: auto;
   padding: 20px;
   border: 5px solid gold;
   border-radius: 20px;
   width: 80%;
   max-width: 600px;
   text-align: center;
   box-shadow: 0 0 40px rgba(255, 215, 0, 0.7);
  }

  .game-modal-content h2 {
   color: gold;
   font-size: 2.5rem;
   margin-bottom: 1rem;
   text-shadow: 2px 2px 4px black, 0 0 20px rgba(255, 215, 0, 0.5);
  }

  .game-modal-content p {
   font-size: 1.3rem;
   color: #fff;
   margin-bottom: 1.5rem;
  }

  /* Responsive adjustments */
  @media (min-width: 768px) {
    .game-content {
        flex-direction: row; /* Torna a riga su schermi pi√π grandi */
        justify-content: center;
    }
    .object-list-container {
        max-width: 250px; /* Riduci larghezza lista su desktop */
        align-self: flex-start; /* Allinea in alto */
    }
    .game-scene-wrapper {
        max-width: 600px; /* Larghezza massima dell'immagine di gioco su desktop */
    }
  }

  @media (max-width: 768px) {
   .game-header h1 {
    font-size: 2rem;
   }
   .object-list-container {
    max-width: 90%; /* Pi√π largo su mobile */
   }
   .game-button {
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
   }
  }

  @media (max-width: 480px) {
   .game-header h1 {
    font-size: 1.5rem;
   }
   .object-list-container h3 {
    font-size: 1.2rem;
   }
   #objects-to-find li {
    font-size: 0.9rem;
   }
  }
 </style>
</head>

<body>

 <div class="hidden-objects-game-container">
  <div class="game-header">
   <h1>
    <span class="emoji-sparkle">üîç</span>
    Trova gli Oggetti Natalizi!
    <span class="emoji-sparkle">üéÑ</span>
   </h1>
  </div>

  <div class="game-content">
   <div class="game-scene-wrapper" id="game-scene-wrapper">
    <img src="images/christmas-scene.jpg" alt="Scena Natalizia" id="christmas-scene-img">
    <!-- Qui verranno aggiunti dinamicamente gli highlight degli oggetti -->
   </div>

   <div class="object-list-container">
    <h3>Oggetti da trovare:</h3>
    <ul id="objects-to-find">
        <img src="images/macchina-gialla.png" alt="Scena Natalizia" id="christmas-scene-img">    </ul>
   </div>
  </div>

  <div class="game-info">
    Oggetti trovati: <span id="found-count">0</span> / <span id="total-objects">0</span>
  </div>

  <div class="game-buttons">
   <button class="game-button" id="start-game-btn" onclick="startGame()">Inizia il Gioco</button>
   <button class="game-button" onclick="resetGame()">Ricomincia</button>
   <button class="game-button" onclick="window.location.href='index.html'">
    üéÑ Torna al Calendario
   </button>
  </div>
 </div>

 <!-- Game Over/Win Modal -->
 <div id="gameEndModal" class="game-modal">
  <div class="game-modal-content">
   <h2 id="modalTitle"></h2>
   <p id="modalMessage"></p>
   <button class="game-button" onclick="resetGame(); closeGameEndModal()">Rigioca</button>
   <button class="game-button" onclick="window.location.href='index.html'">
     üéÑ Torna al Calendario
   </button>
  </div>
 </div>

 <script>
  // ** PASSO 1: CONFIGURA GLI OGGETTI NASCOSTI **
  // Devi sostituire i percorsi delle immagini e definire con precisione le coordinate (x, y, width, height)
  // per ogni oggetto nella tua immagine "christmas_scene.jpg".
  // Le coordinate (x, y) sono relative all'angolo in alto a sinistra dell'immagine.
  // Puoi usare uno strumento di editing immagini per trovare queste coordinate in pixel.
  const hiddenObjectsData = [
   { id: 'oggetto1', name: 'Alberello', icon: 'images/hidden_objects_icons/oggetto1.png', x: 404, y: 747, width: 50, height: 60, found: false },
   { id: 'oggetto2', name: 'Tazza di Cioccolata', icon: 'images/hidden_objects_icons/oggetto2.png', x: 450, y: 620, width: 85, height: 90, found: false },
   { id: 'oggetto3', name: 'Stellina', icon: 'images/hidden_objects_icons/oggetto3.png', x: 490, y: 880, width: 70, height: 60, found: false },
   { id: 'oggetto4', name: 'Ciotolina', icon: 'images/hidden_objects_icons/oggetto4.png', x: 115, y: 400, width: 80, height: 50, found: false },
   { id: 'oggetto5', name: 'Pupazzo di Neve', icon: 'images/hidden_objects_icons/oggetto5.png', x: 750, y: 888, width: 40, height: 70, found: false },
   { id: 'oggetto6', name: 'Lunetta Rossa', icon: 'images/hidden_objects_icons/oggetto6.png', x: 235, y: 245, width: 82, height: 82, found: false },
   { id: 'oggetto7', name: 'Lecca-Lecca', icon: 'images/hidden_objects_icons/oggetto7.png', x: 460, y: 175, width: 60, height: 60, found: false },
   { id: 'oggetto8', name: 'Pallina', icon: 'images/hidden_objects_icons/oggetto8.png', x: 155, y: 915, width: 50, height: 50, found: false },
];

  let currentObjects = []; // Copia degli oggetti per il gioco attuale
  let objectsFoundCount = 0;
  let gameActive = false;

  const gameSceneWrapper = document.getElementById('game-scene-wrapper');
  const christmasSceneImg = document.getElementById('christmas-scene-img');
  const objectsToFindList = document.getElementById('objects-to-find');
  const foundCountSpan = document.getElementById('found-count');
  const totalObjectsSpan = document.getElementById('total-objects');
  const startGameBtn = document.getElementById('start-game-btn');
  const gameEndModal = document.getElementById('gameEndModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalMessage = document.getElementById('modalMessage');

  function initializeGame() {
   currentObjects = JSON.parse(JSON.stringify(hiddenObjectsData)); // Crea una copia profonda
   objectsFoundCount = 0;
   gameActive = false;

   foundCountSpan.textContent = objectsFoundCount;
   totalObjectsSpan.textContent = currentObjects.length;

   objectsToFindList.innerHTML = '';
   currentObjects.forEach(obj => {
    const listItem = document.createElement('li');
    listItem.id = `object-item-${obj.id}`;
    listItem.textContent = obj.name;
    objectsToFindList.appendChild(listItem);
   });

   // Rimuovi tutti gli highlight esistenti
   document.querySelectorAll('.hidden-object-highlight').forEach(el => el.remove());
   
   startGameBtn.style.display = 'block'; // Mostra il pulsante "Inizia il Gioco"
   gameSceneWrapper.style.cursor = 'auto'; // Cursore normale prima dell'inizio
   christmasSceneImg.removeEventListener('click', handleSceneClick); // Rimuovi listener se presente
   closeGameEndModal(); // Assicurati che il modal sia chiuso
  }

  // Funzione per avviare il gioco
  function startGame() {
   gameActive = true;
   startGameBtn.style.display = 'none'; // Nascondi il pulsante "Inizia il Gioco"
   gameSceneWrapper.style.cursor = 'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewport="0 0 100 100" style="fill:black;font-size:18px;"><text y="50%">üîç</text></svg>\') 15 15, auto'; // Cursore a lente
   christmasSceneImg.addEventListener('click', handleSceneClick);
  }

  // Gestisce il clic sulla scena del gioco
  function handleSceneClick(event) {
   if (!gameActive) return;

   const imgRect = christmasSceneImg.getBoundingClientRect();
   const scaleX = christmasSceneImg.naturalWidth / imgRect.width;
   const scaleY = christmasSceneImg.naturalHeight / imgRect.height;

   // Coordinate del clic relative all'immagine originale (senza scaling)
   const clickX = (event.clientX - imgRect.left) * scaleX;
   const clickY = (event.clientY - imgRect.top) * scaleY;

   let foundThisClick = false;

   currentObjects.forEach(obj => {
    if (!obj.found &&
        clickX >= obj.x &&
        clickX <= (obj.x + obj.width) &&
        clickY >= obj.y &&
        clickY <= (obj.y + obj.height)) {
        
        obj.found = true;
        objectsFoundCount++;
        foundCountSpan.textContent = objectsFoundCount;
        
        // Aggiorna la lista
        const listItem = document.getElementById(`object-item-${obj.id}`);
        if (listItem) {
            listItem.classList.add('found');
        }

        // Aggiungi l'highlight visivo
        const highlightDiv = document.createElement('div');
        highlightDiv.classList.add('hidden-object-highlight');
        highlightDiv.classList.add('found'); // Rendi visibile subito
        
        // Calcola la posizione dell'highlight in percentuale o in pixel scalati
        // √à pi√π robusto usare percentuali se l'immagine pu√≤ ridimensionarsi
        highlightDiv.style.left = `${(obj.x / christmasSceneImg.naturalWidth) * 100}%`;
        highlightDiv.style.top = `${(obj.y / christmasSceneImg.naturalHeight) * 100}%`;
        highlightDiv.style.width = `${(obj.width / christmasSceneImg.naturalWidth) * 100}%`;
        highlightDiv.style.height = `${(obj.height / christmasSceneImg.naturalHeight) * 100}%`;
        
        gameSceneWrapper.appendChild(highlightDiv);
        
        foundThisClick = true;
    }
   });

   if (objectsFoundCount === currentObjects.length) {
    endGame(true); // Tutti gli oggetti trovati, l'utente ha vinto
   }
  }

  // Funzione per terminare il gioco (vittoria/sconfitta)
  function endGame(win) {
   gameActive = false;
   christmasSceneImg.removeEventListener('click', handleSceneClick);
   gameSceneWrapper.style.cursor = 'auto'; // Ripristina il cursore normale

   gameEndModal.style.display = 'flex';
   if (win) {
    modalTitle.innerHTML = '<span class="emoji-sparkle">üéâ</span> HAI VINTO! <span class="emoji-sparkle">üéâ</span>';
    modalMessage.textContent = 'Complimenti! Hai trovato tutti gli oggetti natalizi nascosti!';
   } else {
    // Questo caso non dovrebbe accadere in un gioco a oggetti nascosti senza timer o errori
    modalTitle.innerHTML = '<span class="emoji-sparkle">Game Over</span>';
    modalMessage.textContent = 'Non hai trovato tutti gli oggetti. Riprova!';
   }
  }

  // Funzione per resettare il gioco
  function resetGame() {
   initializeGame();
  }

  // Funzione per chiudere il modal di fine gioco
  function closeGameEndModal() {
   gameEndModal.style.display = 'none';
  }

  // Inizializza il gioco al caricamento della pagina
  document.addEventListener('DOMContentLoaded', initializeGame);

  // Assicurati che la funzione di gestione del clic sia registrata solo quando il gioco inizia
  // e che le dimensioni dell'immagine siano caricate per calcolare correttamente le posizioni
  christmasSceneImg.onload = () => {
    // initializeGame(); // Gi√† chiamato al DOMContentLoaded, ma pu√≤ essere utile se l'immagine carica lentamente
  };
 </script>

 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
